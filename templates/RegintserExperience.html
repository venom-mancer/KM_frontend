
{% extends '_layout.html' %}

{% load static %}
{% block jsBlock %}
<script src="{% static 'assets/vendors/select2/dist/js/select2.min.js' %}"></script>


<script>
    $('#fromDate2').val(normalizeDate($('#id_KnowledgetoDate').val()));
    $('#exampleModal').on('shown.bs.modal', function () {
    $('#text').focus();
    })
    </script>
     <script>
        $('input[type=file]').addClass('form-control');
        $('input[type=number]').addClass('form-control');
        $('input[type=text]').addClass('form-control');
        $('input[type=email]').addClass('form-control');
        function whoValidation(){
            var taskArray = new Array();
            $("input[name=percentageJoin]").each(function() {
            taskArray.push($(this).val());
            });
            const taskArray2 = taskArray.map((i) => Number(i));
            const sum_arr2=taskArray2.reduce((partial_sum, a) => partial_sum + a, 0);
            console.log(taskArray2)
            console.log(sum_arr2)
            if( sum_arr2 ==100 ){
                alert('درصد شما برابر 100 است')
            }
            else{
                alert("درصد شما "+
                    sum_arr2
                    +
                    " است "
                    +
                    "\n"
                    +
                    "درصد صحیح  برابر 100 می باشد"
                    )
            }
            
        }
    </script>
    <script>
        
        $('#fromDate1').val(normalizeDate($('#id_KnowledgeFromDate').val()));
        $('input[type=text]').addClass('form-control');
        $('select').addClass('form-control');
        $(document).ready(function () { $('select').select2(); });
        $('input[type=file]').addClass('form-control');
        $('input[type=number]').addClass('form-control');
        $('#id_KnowledgeFromDate').addClass('hidden');
        $('#id_KnowledgetoDate').addClass('hidden');
        $("#KnowledgeKeywordsViewer").addClass('hidden');
        $("#hideKnowledgeProcess").addClass('hidden');
        document.getElementById('KnowledgeKeywordsViewer').value = document.getElementById('id_KnowledgeKeywords').value

        function datepicker1Change() {
            document.getElementById("id_KnowledgeFromDate").value = fixNumbers($('#fromDate1').val().replace("/", "").replace("/", ""));
        }

        function datepicker2Change() {
            document.getElementById("id_KnowledgetoDate").value = fixNumbers($('#fromDate2').val().replace("/", "").replace("/", ""));
        }

    </script>

    <script>

        function changeRegisterStatus(link){
            // knowledgeProcess check
            chart_value = document.getElementById('id_KnowledgeProcess').value
            title_value = document.getElementById('id_KnowledgeTitle').value

            if (chart_value != '' && title_value != ''){
                        $('#registerDeterminer').val(2)
                    var taskArray = new Array();
                    var counter=0;
                    $("input[name=percentageJoin]").each(function() {
                        if ($(this).val() >=1 && $(this).val() <=99 ){
                            taskArray.push($(this).val());
                        }
                    counter++;
                    });
                    const taskArray2 = taskArray.map((i) => Number(i));
                    const sum_arr2=taskArray2.reduce((partial_sum, a) => partial_sum + a, 0);

                    if ( counter > 1 ){
                        if ( counter == taskArray2.length && sum_arr2 == 100 ){
                        $('form#SubmitFormKnowledge').submit();
                        clickAndDisable(link)
                        }
                        else{
                            alert('درصد مشارکت افراد برابر 100 نیست و یا فیلد آن ها خالی می باشد');
                        }
                    }
                    else{
                        $('form#SubmitFormKnowledge').submit();
                        clickAndDisable(link)
                    }
            }
            else if (title_value == '') {
                alert('عنوان  نمیتواند خالی باشد')
            }
            else {
                alert('حوزه ی دانشی نمیتواند خالی باشد')
            }

        }
    </script>

    <script src="{% static 'assets/vendors/tinymce/tinymce.min.js' %}"></script>
    <!-- tinyMce -->
    <!-- <script type="text/javascript">
        tinymce.init({
            selector: 'textarea',
            editor_select2or: "id_KnowledgeTextSummary",
            height: 300,
            language: "fa_IR",
            plugins: [
                'advlist autolink lists link image charmap print preview hr anchor pagebreak',
                'searchreplace wordcount visualblocks visualchars code fullscreen',
                'insertdatetime media nonbreaking save table directionality',
                'emoticons template paste textpattern imagetools image'
            ],
            image_advtab: true,
            toolbar1: 'bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | styleselect formatselect fontselect fontsizeselect ',
            toolbar2: 'cut copy paste pastetext pasteword | search replace bullist numlist | outdent indent blockquote | undo redo | link unlink anchor image cleanup help code | insertdate inserttime preview | forecolor backcolor',
            toolbar3: 'tablecontrols hr removeformat visualaid | sub sup | charmap emotions iespell media advhr | print | ltr rtl | fullscreen | insertlayer moveforward movebackward absolute | styleprops spellchecker | cite abbr acronym del ins attribs | visualchars nonbreaking template blockquote pagebreak | insertfile insertimage emoticons',
            // enable title field in the Image dialog
            image_title: true,
            // enable automatic uploads of images represented by blob or data URIs
            automatic_uploads: true,
            // add custom filepicker only to Image dialog
            file_picker_types: 'image',
            file_picker_callback: function (cb, value, meta) {
                let input = document.createElement('input');
                input.setAttribute('type', 'file');
                input.setAttribute('accept', 'image/*');
                input.onchange = function () {
                    let file = this.files[0];
                    let reader = new FileReader();
                    reader.onload = function () {
                        let id = 'blobid' + (new Date()).getTime();
                        let blobCache = tinymce.activeEditor.editorUpload.blobCache;
                        let base64 = reader.result.split(',')[1];
                        let blobInfo = blobCache.create(id, file, base64);
                        blobCache.add(blobInfo);
                        // call the callback and populate the Title field with the file name
                        cb(blobInfo.blobUri(), { title: file.name });
                    };
                    reader.readAsDataURL(file);
                };
                input.click();
            }
        });
    </script> -->


    <script>
        function groups(){
            var radios = document.getElementsByName('KnowledgeIsGroup');
            for (var i = 0, length = radios.length; i < length; i++) {
            if (radios[i].checked) {
                if (radios[i].value == 1){
                    $('#Groupsdiv').removeClass('hidden');
                }
                else{
                    $('#Groupsdiv').addClass('hidden');
                }
            }
            }
        }
    </script>
        <script>
            function special(){
                var radios = document.getElementsByName('KnowledgeIsSpecial');
                for (var i = 0, length = radios.length; i < length; i++) {
                if (radios[i].checked) {
                    if (radios[i].value == 1){
                        $('#specdiv').removeClass('hidden');
                    }
                    else{
                        $('#specdiv').addClass('hidden');
                    }
                }
                }
            }
        </script>

    <script>
        $.fn.extend({
            treed: function (o) {

                let openedClass = 'glyphicon-minus-sign';
                let closedClass = 'glyphicon-plus-sign';

                if (typeof o != 'undefined') {
                    if (typeof o.openedClass != 'undefined') {
                        openedClass = o.openedClass;
                    }
                    if (typeof o.closedClass != 'undefined') {
                        closedClass = o.closedClass;
                    }
                }

                //initialize each of the top levels
                let tree = $(this);
                tree.addClass("tree");
                tree.find('li').has("ul").each(function () {
                    let branch = $(this); //li with children ul
                    branch.prepend("<i class='indicator glyphicon " + closedClass + "'></i>");
                    branch.addClass('branch');
                    branch.on('click', function (e) {
                        if (this == e.target) {
                            let icon = $(this).children('i:first');
                            icon.toggleClass(openedClass + " " + closedClass);
                            $(this).children().children().toggle();
                        }
                    })
                    branch.children().children().toggle();
                });
                //fire event from the dynamically added icon
                tree.find('.branch .indicator').each(function () {
                    $(this).on('click', function () {
                        $(this).closest('li').click();
                    });
                });
                //fire event to open branch if the li contains an anchor instead of text
                tree.find('.branch>a').each(function () {
                    $(this).on('click', function (e) {
                        $(this).closest('li').click();
                        e.preventDefault();
                    });
                });
                //fire event to open branch if the li contains a button instead of text
                tree.find('.branch>button').each(function () {
                    $(this).on('click', function (e) {
                        $(this).closest('li').click();
                        e.preventDefault();
                    });
                });
            }
        });

        //Initialization of treeviews

        $('#tree1').treed();

        function setChartId(id, name, type) {
            if (type == 3) {
                document.getElementById('id_KnowledgeProcess').value = id;
                document.getElementById('KnowledgeProcessText').value = name;
            } else {
                alert('لطفا یک فرآیند انتخاب کنید');
            }
            console.log(type)
        }
    </script>
    <script>
        $(document).ready(function () {
            //Initialize tooltips
            $('.nav-tabs > li a[title]').tooltip();

            //Wizard
            $('a[data-toggle="tab"]').on('show.bs.tab', function (e) {

                var $target = $(e.target);

                if ($target.parent().hasClass('disabled')) {
                    return false;
                }
            });

            $(".next-step").click(function (e) {

                var $active = $('.wizard .nav-tabs li.active');
                $active.next().removeClass('disabled');
                nextTab($active);

            });
            $(".prev-step").click(function (e) {

                var $active = $('.wizard .nav-tabs li.active');
                prevTab($active);

            });
        });

        function nextTab(elem) {
            $(elem).next().find('a[data-toggle="tab"]').click();
        }
        function prevTab(elem) {
            $(elem).prev().find('a[data-toggle="tab"]').click();
        }
    </script>
    {% endblock %}

    {% block cssBlock %}
    <link href="{% static 'assets/vendors/select2/dist/css/select2.min.css' %}" rel="stylesheet" />
    <link href="{% static 'custom.css' %}" rel="stylesheet"/>
    <style>
        span.select2.select2-container.select2-container--default {
            width: 100% !important;
        }
    </style>
    <style>
        .bold {
            font-weight : bold;
        }
        .trash-icon{
            top: -20px;
        }
        .enable_red {
            background-color: red;
        }
        .disable_white {
            background-color: white;
        }
    </style>

    {% endblock %}

    {% block pageContent %}
    <div class="">

        <div class="row">
            <section>
                <div class="wizard">
                    <div class="wizard-inner">
                       
                        <ul class="nav nav-tabs" role="tablist">
                        {% if knowledgeType < 5 %}
                        <li role="presentation" class="active">
                            <a href="#step1" data-toggle="tab" aria-controls="step1" role="tab" title="تجربه">
                                <span class="round-tab">
                                    <i class="fa fa-folder-open"></i>
                                </span>
                            </a>
                        </li>

                        <li role="presentation" class="disabled">
                            <a href="#step3" data-toggle="tab" aria-controls="step2" role="tab" title="روش حل">
                                <span class="round-tab">
                                    <i class="fa fa-road"></i>
                                </span>
                            </a>
                        </li>

                        <li role="presentation" class="disabled">
                            <a href="#complete" data-toggle="tab" aria-controls="complete" role="tab" title="نتایج">
                                <span class="round-tab">
                                    <i class="fa fa-check"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                        {% endif %}
                    </div>
 
                    {% for field in KnowledgeForm %}
                        {% if field.errors %}
                            <div class="alert alert-danger">
                                 {{ field.label_tag }} {{ field.errors }}
                            </div>
                        {% endif %}
                    {% endfor %}

                    <form action="" method="post" id="SubmitFormKnowledge" role="form" enctype="multipart/form-data" style="margin-top: -11px;">
                        <div class="tab-content">

                            {% csrf_token %}
                            <input type="number" class="hidden" value="1" name="registerDeterminer" id="registerDeterminer">

                            <div class="tab-pane active" role="tabpanel" id="step1">
                                <div class="x_panel">
                                    <div class="x_title bg-info">

                                        {% if knowledgeType == 1 %}
                                        <h2 class="pull-right">تجربه</h2>
                                        {% elif knowledgeType == 4 %}
                                        <h2 class="pull-right"> دانش مهارت </h2>
                                        {% elif knowledgeType == 5 %}
                                        <h2 class="pull-right">ارتقای شغلی</h2>
                                        {% elif knowledgeType == 3 %}
                                        <h2 class="pull-right">تطبیقی دانش</h2>
                                        {% endif %}


                                        <i class="fa fa-question-circle black-bg" aria-hidden="true" style="font-size: 30px; color: white;right: 10px;margin-right:15px;" data-title="{{ skill_experience }}"></i>
                                        <ul class="nav navbar-left panel_toolbox">
                                            <li>
                                                <a class="close-link"><i class="fa fa-close"></i></a>
                                            </li>
                                            <li>
                                                <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                            </li>
                                        </ul>
                                        <div class="clearfix"></div>
                                    </div>

                                        {% if knowledgeType == 5 %}

                                        <div class="x_content">
                                            <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">عنوان
                                                    </label>
                                                <div class="input-group" id="titleGroup" data-toggle="tooltip"
                                                    title="چنانچه عالقه مند به ثبت تجربه خود هستید درابتدا آن را با کلمه و یا عبارتی چکیده و نامبهم ، برگرفته از همان تجربه نام دهید.">
                                                    {{ KnowledgeForm.KnowledgeTitle }}
                                                    <span id="titleBTN" class="input-group-btn">
                                                        <button type="button"
                                                            onclick="alert('مثال:خدمات رسانی به مناطق محروم و کم برخوردار با حداقل بودجه');"
                                                            class="btn btn-success"><i class="fa fa-question"
                                                                aria-hidden="true"></i></button>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">
                                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">بیان مشکلات</label>
                                                <div class="clearfix"></div>
                                                {{ KnowledgeForm.KnowledgeProblems }}
                                            </div>

                                            <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">
                                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">ارایه راهکار های اجرای حل مشکلات</label>
                                                <div class="clearfix"></div>
                                                {{ KnowledgeForm.KnowledgeSolution }}
                                            </div>

                                            <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">
                                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">بیان خصوصیات و ویژگی های شغل خود</label>
                                                <div class="clearfix"></div>
                                                {{ KnowledgeForm.KnowledgeTellJobSpecial }}
                                            </div>

                                            <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">
                                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">موفقیت های شغلی کسب شده</label>
                                                <div class="clearfix"></div>
                                                {{ KnowledgeForm.KnowledgeJobSuccess }}
                                            </div>

                                            {% else %}
                                            <div class="x_content">
                                                <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                                                    {% if knowledgeType == 4 %}
                                                    <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">عنوان مهارت: </label>
                                                    {% elif knowledgeType == 6 %}
                                                    <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">عنوان : </label>
                                {% else %}
                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">عنوان
                                    تجریه</label>
                                {% endif %}
                                {{ KnowledgeForm.KnowledgeTitle }}

                                </div>

                                        {% endif %}

                                        {% if knowledgeType < 5 %}
                                        <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                                            <label class="control-label col-md-6 col-sm-12 col-xs-12 pull-right">مکان وقوع تجربه کدام است :</label>
                                            {{ KnowledgeForm.KnowledgePlace }}
                                        </div>
                                        {% endif %}

                                        {% if knowledgeType == 1 or knowledgeType == 3 or knowledgeType == 4 %}
                                        <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right ">
                                            <label for="fromDate1"
                                                class="control-label col-md-5 col-sm-3 col-xs-12 pull-right">تاریخ
                                                بروز
                                                تجربه </label>
                                            <input type="text" class="form-control" id="fromDate1"
                                                data-mddatetimepicker="true" data-trigger="click"
                                                data-targetselector="#fromDate1" data-groupid="group1" data-fromdate="true"
                                                data-enabletimepicker="false" data-placement="right"
                                                onchange="datepicker1Change()">
                                            {{ KnowledgeForm.KnowledgeFromDate }}
                                        </div>
                                        {% else %}
                                        <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right hidden">
                                            <label for="fromDate1"
                                                class="control-label col-md-5 col-sm-3 col-xs-12 pull-right">تاریخ
                                                بروز
                                                تجربه </label>
                                            <input type="text" class="form-control" id="fromDate1"
                                                data-mddatetimepicker="true" data-trigger="click"
                                                data-targetselector="#fromDate1" data-groupid="group1" data-fromdate="true"
                                                data-enabletimepicker="false" data-placement="right"
                                                onchange="datepicker1Change()">
                                            {{ KnowledgeForm.KnowledgeFromDate }}
                                        </div>

                                        {% endif %}

                                        {% if knowledgeType == 5 %}
                                        <div class="clearfix"></div> {% endif %}
                                        {% if knowledgeType == 1 or knowledgeType == 3 or knowledgeType == 4 %} <div
                                            class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                                            <label for="fromDate2"
                                                class="control-label col-md-5 col-sm-3 col-xs-12 pull-right">تا
                                                تاریخ</label>
                                            <input type="text" class="form-control" id="fromDate2"
                                                data-mddatetimepicker="true" data-trigger="click"
                                                data-targetselector="#fromDate2" data-groupid="group1" data-fromdate="true"
                                                data-enabletimepicker="false" data-placement="right"
                                                onchange="datepicker2Change()">
                                            {{ KnowledgeForm.KnowledgetoDate }}
                                        </div>
                                        {% endif %}

                                        <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                                            <label for="KnowledgeProcessText"
                                                class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">حوزه
                                                دانش(فرآیند دانش)</label>
                                            <ul id="tree1">
                                                {{ html_chart|safe }}
                                            </ul>
                                            <input type="text" id="KnowledgeProcessText" name="KnowledgeProcessText"
                                                class="form-control" value="{{ KnowledgeProcess }}" disabled>
                                            <div id="hideKnowledgeProcess">
                                                {{ KnowledgeForm.KnowledgeProcess }}
                                            </div>

                                        </div>

                                        {% if knowledgeType < 5 %}
                                        <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">
                                            <label for="keyword" class="control-label col-md-12 col-sm-12 col-xs-12 pull-right"> واژگان کلیدی
                                                </label>
                                            <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">

                                                <div class="input-group" id="whoGroup">
                                                    <input type="text" id="keyword" class="form-control" />
                                                    <span class="input-group-btn">
                                                        <button type="button" onclick="addKeyword()" class="btn btn-primary"><i
                                                                class="fa fa-plus"></i></button>
                                                    </span>
                                                </div>
                                            </div>
                                            <script>
                                                function addKeyword() {
                                                    let keyword = document.getElementById('keyword').value.trim();
                                                    console.log('keyword', keyword);
                                                    if (keyword.length > 0) {
                                                        let keywords = document.getElementById('id_KnowledgeKeywords').value.trim();
                                                        if (keywords.length > 0) {
                                                            document.getElementById('id_KnowledgeKeywords').value = keywords + ', ' + keyword;
                                                        } else {
                                                            document.getElementById('id_KnowledgeKeywords').value = keyword;
                                                        }
                                                        document.getElementById('KnowledgeKeywordsViewer').value = document.getElementById('id_KnowledgeKeywords').value
                                                        document.getElementById('keyword').value = '';
                                                    }
                                                }
                                            </script>
                                            <input class="form-control" value="" id="KnowledgeKeywordsViewer" disabled>
                                            <div class='input-group' style="padding: 15px;">
                                                {{ KnowledgeForm.KnowledgeKeywords }}
                                                <span class="input-group-btn">
                                                    <button onclick="EnableFunc();" type='button' class='btn btn-dark'>
                                                        <i class='fa fa-pencil' aria-hidden='true' ></i>
                                                    </button>
                                                </span>
                                            </div>
                                        </div>

                                        <div class="clearfix"></div>

                                        <ul class="list-inline pull-right">
                                            <li>
                                                <button type="button" class="btn btn-primary next-step">بعدی
                                                </button>
                                                <button id="btn1" onclick="changeRegisterStatus(this);" class="btn btn-success" type="button">
                                                    ثبت موقت
                                                </button>
                                            </li>
                                        </ul>
                                    </div>

                                </div>
                            </div>
                            <div class="tab-pane" role="tabpanel" id="step2">
                                <div class="x_panel">
                                    <div class="x_title bg-secondary">
                                        <h2 class="pull-right">تجربه</h2>
                                        <ul class="nav navbar-left panel_toolbox">
                                            <li>
                                                <a class="close-link"><i class="fa fa-close"></i></a>
                                            </li>
                                            <li>
                                                <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                            </li>
                                        </ul>
                                        <div class="clearfix"></div>
                                    </div>

                                    <div class="x_content">
                                {% endif %}

                                <div class="clearfix"></div>
                                <ul class="list-inline pull-right">

                                    {% if knowledgeType < 5 %}
                                    <li>
                                        <button type="button" class="btn btn-default prev-step">مرحله
                                            قبل
                                        </button>
                                    </li>
                                    <li>
                                        <button type="button" class="btn btn-primary next-step">مرحله
                                            بعد
                                        </button>
                                    </li>
                                    {% else %}
                                    <li>
                                        <button onclick="changeRegisterStatus(this);" class="btn btn-primary">ثبت
                                        </button>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>

                        </div>
                </div>
                <div class="tab-pane" role="tabpanel" id="step3">
                    <div class="x_panel">
                        <div class="x_title bg-primary">

                            {% if knowledgeType != 4 %}
                            <h2 class="pull-right">شرح تجربه</h2>
                            {% else %}
                            <h2 class="pull-right">شرح مهارت</h2>
                            {% endif %}


                            <ul class="nav navbar-left panel_toolbox">
                                <li>
                                    <a class="close-link"><i class="fa fa-close"></i></a>
                                </li>
                                <li>
                                    <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                </li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>

                        <div class="x_content">
                            <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">

                                {% if knowledgeType == 3 %}
                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">کاربرد دانش در سازمان </label>
                                {% elif knowledgeType == 4  %}
                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">فرایند اجرا </label>
                                {% else %}
                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">شرح تجربه(روش حل مشکل) </label>
                                {% endif %}


                                <div class="clearfix"></div>
                                {{ KnowledgeForm.KnowledgeWhichAction }}
                            </div>
                            {% if knowledgeType < 5 %}
                            <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">

                                {% if knowledgeType == 1 %}
                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">رویداد یا مشکلی که منجر به کسب تجربه شده: </label>
                                {% elif knowledgeType == 3  %}
                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">موانع اجرا در سازمان: </label>
                                {% else %}
                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">مزایای اجرا: </label>
                                {% endif %}

                                <div class="clearfix"></div>

                                {{ KnowledgeForm.KnowledgeCause }}
                            </div>
                        {% endif %}
                                <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">
                                            <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">خلاصه
                                                دانش </label>
                                            <div class="clearfix"></div>
                                            {{ KnowledgeForm.KnowledgeTextSummary }}
                                 </div>
                        <div class="clearfix"></div>
                        <ul class="list-inline pull-right">
                            <li>
                                <button type="button" class="btn btn-default prev-step">مرحله
                                    قبل
                                </button>
                            </li>
                            <li>
                                <button type="button" class="btn btn-primary btn-info-full next-step">
                                    مرحله
                                    بعد
                                </button>
                            </li>
                            <li>
                                <button id="btn2"  onclick="changeRegisterStatus(this);" class="btn btn-success" type="button">
                                    ثبت موقت
                                </button>
                            </li>
                        </ul>
                    </div>

                </div>
        </div>
        <div class="tab-pane" role="tabpanel" id="complete">
            <div class="x_panel">
                <div class="x_title bg-success">
                    <h2 class="pull-right">نتایج</h2>
                    <ul class="nav navbar-left panel_toolbox">
                        <li>
                            <a class="close-link"><i class="fa fa-close"></i></a>
                        </li>
                        <li>
                            <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>

                <div class="x_content">
                    {% if knowledgeType < 4 %}  <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">
                        {% if knowledgeType == 1 %}
                        <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">نتایج اجرای تجربه</label>
                                {% else %}
                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">تغییرات مورد نیاز به منظور بومی سازی: </label>
                                {% endif %}
                        <div class="clearfix"></div>
                        {{ KnowledgeForm.KnowledgeResults }}
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">
                        {% if knowledgeType == 1 %}
                        <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">پیشنهادات حاصل از تجربه</label>
                                {% else %}
                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">مخاطبین دانش: </label>
                                {% endif %}
                        <div class="clearfix"></div>
                        {{ KnowledgeForm.KnowledgeUsedCases }}
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right pb-5">
                        {% if knowledgeType == 1 %}
                        <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">مخاطبان و کاربران (موارد کاربرد)</label>
                                {% else %}
                                <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">منابع و ماخذ دانش (این دانش از کجا حاصل شده است): </label>
                                {% endif %}
                        <div class="clearfix"></div>
                        {{ KnowledgeForm.KnowledgeUsers }}
                    </div>
                {% endif %}

                <script>
                    var tableIndex2 = 0;
                    function add23Team() {
                        docTitle_value = document.getElementById('docTitle').value
                        if (docTitle_value != ''){
                            let val2 = $('#docTitle').val();
                        console.log(val2)
                        let text2 = $('#docTitle').val();
                        var x2 = document.getElementById("tblFile").rows.namedItem(val2);
                        console.log(x2);
                        if (x2 == null && text2.trim() !='') {
                            var table2 = document.getElementById("tblFile");
                            var row2 = table2.insertRow(tableIndex2);
                            row2.id = val2;
                            var cell11 = row2.insertCell(0);
                            var cell22 = row2.insertCell(1);
                            var cell33 = row2.insertCell(2);
                            cell11.innerHTML = text2 + "<input name='docTitle' value='" + val2.trim() + "' class='hidden'>";
                            cell22.innerHTML="<input name='Allfiles' required type='file' class=''>"
                            cell33.innerHTML = "<span class='glyphicon glyphicon-trash row-remover2 btn btn-danger '></span>";
                            tableIndex2++;
                        }
                        $('#docTitle').val('')
                    }
                    else {
                        alert('عنوان ضمیمه نمیتواند خالی باشد ')
                    }
                        
                    }
                    $("body").on('click', '.row-remover2', function() {
                        $(this).closest('tr').remove();
                        tableIndex2--;
                    });
                </script>

<!-- just ignore it and dont delete it -->
<div class="input" style="display: none;">
    <input type="number" id="num" class="form-control" min="0">
    <select id="measure" class="form-control">
        <option value="0">Select Unit</option>
        <option value="s">Seconds</option>
        <option value="m">Minutes</option>
        <option value="h">Hours</option>
    </select>
</div>
<button style="display: none;" class="btn hidden" id="start-countdown">Start Countdown</button>


            <div style="border: solid 1px;" class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">
                <div class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">
                    <label class="control-label col-md-5 col-sm-3 col-xs-12 pull-right pb-5"> ویس :
                        </label>
                        <div id="controls">
                            <br>
                            <button class="btn btn-danger" style="border: solid black 1px;" type="button" id="recordButton"><i style="font-size: 15px;color: black;" class="fa fa-podcast " aria-hidden="true"></i> Record</button>
                            <button class="btn btn-light" style="border: solid black 1px;" type="button" id="pauseButton" disabled><i class="fa fa-pause " style="color: black;" aria-hidden="true"></i> Pause</button>
                            <button class="btn btn-light" style="border: solid black 1px;" type="button" id="stopButton" disabled><i class="fa fa-stop " style="color: black;" aria-hidden="true"></i> Stop</button>
                        </div>
                        
                        <input type="text" name="hidden_audio" id="hidden_audio" style="display:none;">

                         <div id="timer" class="col-12">

                            <div dir="ltr" class="clock-wrapper">
                                <span class="hours bold">00</span>
                                <span class="dots bold">:</span>
                                <span class="minutes bold">00</span>
                                <span class="dots bold">:</span>
                                <span class="seconds bold">00</span>
                            </div>
          
                          </div>

                         <div id="formats"></div>
                           <ul style="list-style-type: none;max-width: min-content;" id="recordingsList">

                            
                            {% if voice != 0 %}
                            <li>
                                <div class="row">
                                    <audio controls="" src="{{ voice }}"></audio><span class="glyphicon glyphicon-trash btn btn-danger row-remover8555"></span>
                                </div>
                            </li>
                            {% endif %}
                                

                        </ul>
                </div>
            </div>


            <div style="border: solid 1px;" class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">
                <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                    <label class="control-label col-md-5 col-sm-3 col-xs-12 pull-right pb-5">عنوان ضمیمه :
                         </label>
                    <input id="docTitle" type="text">
                    <button onclick="add23Team();" class="btn btn-primary" style="margin:15px 3px" type="button">افزودن <i class="fa fa-plus" aria-hidden="true"></i></button>
                </div>

                <br>
                <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right ">
                    <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                        <table class="table table-striped table-bordered dt-responsive nowrap"
                            cellspacing="0" width="100%">
                            <thead>
                                <tr>
                                    <th>عنوان فایل</th>
                                    <th>اسم فایل</th>
                                    <th>حذف</th>
                                </tr>
                            </thead>
                            <tbody id="tblFile">

                                {% for item in obj_files %}
                                <tr>
                                    <td>
                                    {{ item.title }}
                                    <input value="{{ item.title }}" class='hidden'>
                                    </td>
                                    <td>
                                        <a href="/media/{{ item.file }}" target="_blank">{{ item.file.name }}</a>
                                    </td>
                                    <td>
                                        <span onclick='ajaxFunc("{{ item.id }}");' class='glyphicon glyphicon-trash row-remover2 btn btn-danger'></span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

                {% if permission_knowledge == 1  %}
                <div style="margin: 25px 1px;" class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                    <label for="CreatorUserID"
                    class="control-label col-md-5 col-sm-3 col-xs-12 pull-right"> آیا دانش شما محرمانه است؟ </label>
                    <div class="toggle-radio">
                        <input type="radio" name="KnowledgePermission" id="yes1" checked value="1">
                        <input type="radio" name="KnowledgePermission" id="no1" value="2">
                        <div class="switch" style="margin:-19px -14px;">
                          <label for="yes1">بله</label>
                          <label for="no1">خیر</label>
                          <span></span>
                        </div>
                      </div>
                </div>
                {% else %}

                <div style="margin: 25px 1px;" class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                    <label for="CreatorUserID"
                    class="control-label col-md-5 col-sm-3 col-xs-12 pull-right">آیا دانش شما محرمانه است؟</label>
                    <div class="toggle-radio">
                        <input type="radio" name="KnowledgePermission" id="yes1" value="1">
                        <input type="radio" name="KnowledgePermission" id="no1" checked value="2">
                        <div class="switch" style="margin:-19px -14px;">
                          <label for="yes1">بله</label>
                          <label for="no1">خیر</label>
                          <span></span>
                        </div>
                      </div>
                </div>

                {% endif %}

                {% if special_knowledge == 1 %}
                    <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right" onchange="special();" >
                        <label for="CreatorUserID"
                        class="control-label col-md-5 col-sm-3 col-xs-12 pull-right">آیا دانش شما ویژه است؟</label>       <div class="toggle-radio">
                            <input type="radio" name="KnowledgeIsSpecial" id="yes"checked value="1">
                            <input type="radio" name="KnowledgeIsSpecial" id="no" value="2">
                            <div class="switch" style="margin:-19px -14px;">
                              <label for="yes">بله</label>
                              <label for="no">خیر</label>
                              <span></span>
                            </div>
                          </div>
                    </div>
                    <div id='specdiv' class="col-md-12 col-sm-12 col-xs-12 form-group pull-right">
                        {{ KnowledgeForm.KnowledgeSpecialReason }}
                    </div>

                {% else %}
                    <div  class="col-md-6 col-sm-12 col-xs-12 form-group pull-right" onchange="special();" >
                        <label for="CreatorUserID"
                        class="control-label col-md-5 col-sm-3 col-xs-12 pull-right">آیا دانش شما ویژه است؟</label>
                        <div class="toggle-radio">
                            <input type="radio" name="KnowledgeIsSpecial" id="yes" value="1">
                            <input type="radio" name="KnowledgeIsSpecial" id="no" checked value="2">
                            <div class="switch" style="margin:-19px -14px;">
                              <label for="yes">بله</label>
                              <label for="no">خیر</label>
                              <span></span>
                            </div>
                          </div>
                    </div>
                    <div id='specdiv' class="control-label col-md-12 col-sm-12 col-xs-12 pull-right hidden">
                        <textarea name="KnowledgeSpecialReason" id="" cols="30" rows="10"></textarea>
                    </div>
                    <br>
                {% endif %}
                    <br>
                {% if len_team > 1 %}
                <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right" onchange="groups();">
                    <label for="CreatorUserID"
                        class="control-label col-md-5 col-sm-3 col-xs-12 pull-right" style="padding: 16px 0px;" >آیا دانش شما گروهی است؟</label>
                        <div class="toggle-radio">
                            <input type="radio" name="KnowledgeIsGroup" id="yes2" checked value="1">
                            <input type="radio" name="KnowledgeIsGroup" id="no2" value="2">
                            <div class="switch" style="margin:-18px -14px;">
                              <label for="yes2">بله</label>
                              <label for="no2">خیر</label>
                              <span></span>
                            </div>
                          </div>
                </div>
                {% else %}
                    <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right" onchange="groups();">
                        <label for="CreatorUserID"
                            class="control-label col-md-5 col-sm-3 col-xs-12 pull-right" style="padding: 16px 0px;">آیا دانش شما گروهی است؟</label>
                            <div class="toggle-radio">
                                <input type="radio" name="KnowledgeIsGroup" id="yes2" value="1">
                                <input type="radio" name="KnowledgeIsGroup" id="no2"checked value="2">
                                <div class="switch" style="margin:-19px -14px;">
                                  <label for="yes2">بله</label>
                                  <label for="no2">خیر</label>
                                  <span></span>
                                </div>
                              </div>
                    </div>
                {% endif %}

                {% if len_team > 1 %}
                <div id="Groupsdiv" class="col-md-12 col-sm-12 col-xs-12 form-group pull-right l">
                    <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                        <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">چه
                            کسی </label>
                        <div class="input-group" id="whoGroup" data-toggle="tooltip"
                            title=" فرد و یا افراد تصمیم گیرنده و یا موثر چه کسانی هستند.">
                            <select name="members" id="id_members">
                                {% for item in members %}
                                <option value="{{item.member}}">{{item.first_name}} {{item.last_name}}</option>
                                {% endfor %}
                            </select>
                            <span class="input-group-btn">
                                <button type="button"
                                    onclick="alert('مثال:پیگیری شخصی بر اساس اولویت بندی وظایف');"
                                    class="btn btn-success"><i class="fa fa-question"
                                        aria-hidden="true"></i></button>
                                <button type="button" onclick="add2Team()" class="btn btn-primary"><i
                                        class="fa fa-plus"></i></button>
                            </span>
                        </div>
                    </div>
                    <script>
                        let tableIndex = {{ teamCount }};
                        function add2Team() {

                            let val = $('#id_members').val();
                            let text = $("#id_members option:selected").text();
                            var x = document.getElementById("tblTeam").rows.namedItem(val);
                            console.log(x);
                            if (x == null) {
                                var table = document.getElementById("tblTeam");
                                var row = table.insertRow(tableIndex);
                                row.id = val;
                                var cell1 = row.insertCell(0);
                                var cell2 = row.insertCell(1);
                                var cell3 = row.insertCell(2);
                                cell1.innerHTML = text + "<input name='member' value='" + val + "' class='hidden'>";
                                cell2.innerHTML = "<span class='glyphicon glyphicon-trash row-remover btn btn-danger '></span>";
                                cell3.innerHTML="<input name='percentageJoin' required   max='99' min='1' type='number'  style='width: 35%;'>"
                                tableIndex++;
                            }
                        }
                        $("body").on('click', '.row-remover', function() {
                            $(this).closest('tr').remove();
                            tableIndex--;
                        });
                    </script>
                    <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                        <table class="table table-striped table-bordered dt-responsive nowrap"
                            cellspacing="0" width="100%">
                            <thead>
                                <tr>
                                    <th>نام</th>
                                    <th>حذف</th>
                                    <th>درصد مشارکت</th>
                                </tr>
                            </thead>
                            <tbody id="tblTeam">
                                <tr id="{{request.user.member}}">
                                    <td>
                                        {{request.user.first_name}} {{request.user.last_name}}
                                        <input name='member' value='{{request.user.member}}' class='hidden'>
                                    </td>

                                    <td>
                                    </td>

                                    {% if userPercentage > 0 %}
                                        <td>
                                            <input name="percentageJoin" value="{{ userPercentage }}"   max="99" min="1" style="width:35%" type="number">
                                        </td>
                                    {% else %}
                                    <td>
                                        <input name="percentageJoin" max="99" min="1" style="width:35%" type="number">
                                    </td>
                                    {% endif %}
                                </tr>
                                {% for item in team %}
                                <tr id="{{item.TeamMember.member}}">
                                    <td>
                                        {{item.TeamMember.first_name}} {{item.TeamMember.last_name}}
                                        <input name='member' value='{{item.TeamMember.member}}'
                                            class='hidden'>
                                    </td>
                                    <td>
                                        <span class='glyphicon glyphicon-trash row-remover btn btn-danger '></span>
                                    </td>
                                    <td>
                                        <input name="percentageJoin" value="{{ item.joinPercentage }}"   max="99" min="1" style="width:35%" type="number">
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <button type="button" class="btn btn-success" onclick="whoValidation();" >چک درصد</button>
                    </div>
                </div> 
                {% else %}
                <div id="Groupsdiv" class="col-md-12 col-sm-12 col-xs-12 form-group pull-right hidden">
                    <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                        <label class="control-label col-md-12 col-sm-12 col-xs-12 pull-right">چه
                            کسی </label>
                        <div class="input-group" id="whoGroup" data-toggle="tooltip"
                            title=" فرد و یا افراد تصمیم گیرنده و یا موثر چه کسانی هستند.">
                            <select name="members" id="id_members">
                                {% for item in members %}
                                <option value="{{item.member}}">{{item.first_name}} {{item.last_name}}</option>
                                {% endfor %}
                            </select>
                            <span class="input-group-btn">
                                <button type="button"
                                    onclick="alert('مثال:پیگیری شخصی بر اساس اولویت بندی وظایف');"
                                    class="btn btn-success"><i class="fa fa-question"
                                        aria-hidden="true"></i></button>
                                <button type="button" onclick="add2Team()" class="btn btn-primary"><i
                                        class="fa fa-plus"></i></button>
                            </span>
                        </div>
                    </div>
                    <script>
                        let tableIndex = {{ teamCount }};
                        function add2Team() {

                            let val = $('#id_members').val();
                            let text = $("#id_members option:selected").text();
                            var x = document.getElementById("tblTeam").rows.namedItem(val);
                            console.log(x);
                            if (x == null) {
                                var table = document.getElementById("tblTeam");
                                var row = table.insertRow(tableIndex);
                                row.id = val;
                                var cell1 = row.insertCell(0);
                                var cell2 = row.insertCell(1);
                                var cell3 = row.insertCell(2);
                                cell1.innerHTML = text + "<input name='member' value='" + val + "' class='hidden'>";
                                cell2.innerHTML = "<span class='glyphicon glyphicon-trash row-remover btn btn-danger '></span>";
                                cell3.innerHTML="<input name='percentageJoin' required   max='99' min='1' type='number'  style='width: 35%;'>"
                                tableIndex++;
                            }
                        }
                        $("body").on('click', '.row-remover', function() {
                            $(this).closest('tr').remove();
                            tableIndex--;
                        });
                    </script>
                    <div class="col-md-6 col-sm-12 col-xs-12 form-group pull-right">
                        <table class="table table-striped table-bordered dt-responsive nowrap"
                            cellspacing="0" width="100%">
                            <thead>
                                <tr>
                                    <th>نام</th>
                                    <th>حذف</th>
                                    <th>درصد مشارکت</th>
                                </tr>
                            </thead>
                            <tbody id="tblTeam">
                                <tr id="{{request.user.member}}">
                                    <td>
                                        {{request.user.first_name}} {{request.user.last_name}}
                                        <input name='member' value='{{request.user.member}}' class='hidden'>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                        <p id="demo"></p>
                                        <input name="percentageJoin"   max="99" min="1" style="width:35%" type="number">
                                    </td>
                                </tr>
                                {% for item in team %}
                                <tr id="{{item.TeamMember.member}}">
                                    <td>
                                        {{item.TeamMember.first_name}} {{item.TeamMember.last_name}}
                                        <input name='member' value='{{item.TeamMember.member}}'
                                            class='hidden'>
                                    </td>
                                    <td>
                                        <a class='btn btn-danger' href='#'
                                            onclick='deleteFromTeam({{forloop.counter}})'>حذف</a>
                                    </td>
                                    <td>
                                        <p id="demo{{forloop.counter}}"></p>
                                        <input id="id{{forloop.counter}}" value="100" type="range">
                                    <script>
                                        let slider = document.getElementById("id{{forloop.counter}}");
                                        let output = document.getElementById("demo{{forloop.counter}}");
                                        output.innerHTML = slider.value; 
                                        slider.oninput = function () {
                                            output.innerHTML = this.value;
                                        }
                                    </script>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <button type="button" class="btn btn-success" onclick="whoValidation();" >چک درصد</button>
                    </div>
                </div>
                {% endif %}

                <input type="text" name="CreatorUserID" class="hidden" id="CreatorUserID"
                value="{{ request.user.member }}">

                <input type="number" name="register_status" class="hidden" id="register_status"
                value=2>
                <div class="clearfix"></div>
                <div class="clearfix"></div>
                <div class="col-md-3 col-sm-12 col-xs-12 form-group pull-right">
                    <input class="hidden" id="id_Type" name="Type" value="{{knowledgeType}}">
                    <button type="button" onclick="checkMember(this);" id="saveButton" class="btn btn-primary">ذخیره</button>
                </div>
            </div>

        </div>
    </div>
    <div class="clearfix"></div>
    </div>
    </form>
    </div>
    </section>
    </div>
    </div>
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input class="form-control" id="text">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">خروج</button>
                    <button type="button" class="btn btn-primary" id="btnAJaxSave" onclick="">ثبت</button>
                </div>
            </div>
        </div>
    </div>

    <script type="application/javascript">
        function ajaxFunc(idObjFile) {
            // e.preventDefault();
            $.ajax({
                type: 'POST',
                url: '/removeFile',
                data: {
                    fileid: idObjFile,
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post'
                },
                success: function (json) {
                    // if (json['result'] == "success" ){
                    //     alert('success')
                    // }
                },
                error: function (xhr, errmsg, err) {
                    // alert('faild')
                }
            });
        }
    </script>
    <script>
        function checkMember(link){
            chart_value = document.getElementById('id_KnowledgeProcess').value
            if (chart_value != ''){
                var taskArray = new Array();
                var counter=0;
                $("input[name=percentageJoin]").each(function() {
                    if ($(this).val() >=1 && $(this).val() <=99 ){
                        taskArray.push($(this).val());
                    }
                counter++;
                });
                const taskArray2 = taskArray.map((i) => Number(i));
                const sum_arr2=taskArray2.reduce((partial_sum, a) => partial_sum + a, 0);

                console.log(taskArray2)
                console.log(sum_arr2)
                console.log(counter)

                if ( counter > 1 ){
                    if ( counter == taskArray2.length && sum_arr2 == 100 ){
                    $('form#SubmitFormKnowledge').submit();
                    clickAndDisable(link)
                    }
                    else{
                        alert('درصد مشارکت افراد برابر 100 نیست و یا فیلد آن ها خالی می باشد');
                    }
                }
                else{
                    $('form#SubmitFormKnowledge').submit();
                    clickAndDisable(link)
                }
            }
        else {
            alert('حوزه ی دانشی نمیتواند خالی باشد')
        }
            
        };
    </script>
    <script type="application/javascript">
        function register(url, dropdownid) {
            url+="";
            $.ajax({
                data: {
                    text: $('#text').val(),
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    dataType: "json",
                },
                type: 'post',
                url: url,
                success: function (response) {
                    document.getElementById(dropdownid).innerHTML = "";
                    let arr_from_json = JSON.parse(response);

                    for (let i = 0; i < arr_from_json.length; i++) {
                        $('#' + dropdownid).append("<option value=" + arr_from_json[i].id + ">" + arr_from_json[i].text + "</option>");
                    }
                    $('#exampleModal').modal('toggle');
                    document.getElementById("text").value = "";
                    let myVal = $('#' + dropdownid + ' option:last').val();
                    $('#' + dropdownid).val(myVal);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                },
            });
        }
    </script>
    <script>
    function clickAndDisable(link) {
     // disable subsequent clicks
     link.onclick = function(event) {
        event.preventDefault();
     }
   }   
    </script>



<script>

(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Recorder = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
    "use strict";
    
    module.exports = require("./recorder").Recorder;
    
    },{"./recorder":2}],2:[function(require,module,exports){
    'use strict';
    
    var _createClass = (function () {
        function defineProperties(target, props) {
            for (var i = 0; i < props.length; i++) {
                var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);
            }
        }return function (Constructor, protoProps, staticProps) {
            if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;
        };
    })();
    
    Object.defineProperty(exports, "__esModule", {
        value: true
    });
    exports.Recorder = undefined;
    
    var _inlineWorker = require('inline-worker');
    
    var _inlineWorker2 = _interopRequireDefault(_inlineWorker);
    
    function _interopRequireDefault(obj) {
        return obj && obj.__esModule ? obj : { default: obj };
    }
    
    function _classCallCheck(instance, Constructor) {
        if (!(instance instanceof Constructor)) {
            throw new TypeError("Cannot call a class as a function");
        }
    }
    
    var Recorder = exports.Recorder = (function () {
        function Recorder(source, cfg) {
            var _this = this;
    
            _classCallCheck(this, Recorder);
    
            this.config = {
                bufferLen: 4096,
                numChannels: 2,
                mimeType: 'audio/wav'
            };
            this.recording = false;
            this.callbacks = {
                getBuffer: [],
                exportWAV: []
            };
    
            Object.assign(this.config, cfg);
            this.context = source.context;
            this.node = (this.context.createScriptProcessor || this.context.createJavaScriptNode).call(this.context, this.config.bufferLen, this.config.numChannels, this.config.numChannels);
    
            this.node.onaudioprocess = function (e) {
                if (!_this.recording) return;
    
                var buffer = [];
                for (var channel = 0; channel < _this.config.numChannels; channel++) {
                    buffer.push(e.inputBuffer.getChannelData(channel));
                }
                _this.worker.postMessage({
                    command: 'record',
                    buffer: buffer
                });
            };
    
            source.connect(this.node);
            this.node.connect(this.context.destination); //this should not be necessary
    
            var self = {};
            this.worker = new _inlineWorker2.default(function () {
                var recLength = 0,
                    recBuffers = [],
                    sampleRate = undefined,
                    numChannels = undefined;
    
                self.onmessage = function (e) {
                    switch (e.data.command) {
                        case 'init':
                            init(e.data.config);
                            break;
                        case 'record':
                            record(e.data.buffer);
                            break;
                        case 'exportWAV':
                            exportWAV(e.data.type);
                            break;
                        case 'getBuffer':
                            getBuffer();
                            break;
                        case 'clear':
                            clear();
                            break;
                    }
                };
    
                function init(config) {
                    sampleRate = config.sampleRate;
                    numChannels = config.numChannels;
                    initBuffers();
                }
    
                function record(inputBuffer) {
                    for (var channel = 0; channel < numChannels; channel++) {
                        recBuffers[channel].push(inputBuffer[channel]);
                    }
                    recLength += inputBuffer[0].length;
                }
    
                function exportWAV(type) {
                    var buffers = [];
                    for (var channel = 0; channel < numChannels; channel++) {
                        buffers.push(mergeBuffers(recBuffers[channel], recLength));
                    }
                    var interleaved = undefined;
                    if (numChannels === 2) {
                        interleaved = interleave(buffers[0], buffers[1]);
                    } else {
                        interleaved = buffers[0];
                    }
                    var dataview = encodeWAV(interleaved);
                    var audioBlob = new Blob([dataview], { type: type });
    
                    self.postMessage({ command: 'exportWAV', data: audioBlob });
                }
    
                function getBuffer() {
                    var buffers = [];
                    for (var channel = 0; channel < numChannels; channel++) {
                        buffers.push(mergeBuffers(recBuffers[channel], recLength));
                    }
                    self.postMessage({ command: 'getBuffer', data: buffers });
                }
    
                function clear() {
                    recLength = 0;
                    recBuffers = [];
                    initBuffers();
                }
    
                function initBuffers() {
                    for (var channel = 0; channel < numChannels; channel++) {
                        recBuffers[channel] = [];
                    }
                }
    
                function mergeBuffers(recBuffers, recLength) {
                    var result = new Float32Array(recLength);
                    var offset = 0;
                    for (var i = 0; i < recBuffers.length; i++) {
                        result.set(recBuffers[i], offset);
                        offset += recBuffers[i].length;
                    }
                    return result;
                }
    
                function interleave(inputL, inputR) {
                    var length = inputL.length + inputR.length;
                    var result = new Float32Array(length);
    
                    var index = 0,
                        inputIndex = 0;
    
                    while (index < length) {
                        result[index++] = inputL[inputIndex];
                        result[index++] = inputR[inputIndex];
                        inputIndex++;
                    }
                    return result;
                }
    
                function floatTo16BitPCM(output, offset, input) {
                    for (var i = 0; i < input.length; i++, offset += 2) {
                        var s = Math.max(-1, Math.min(1, input[i]));
                        output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
                    }
                }
    
                function writeString(view, offset, string) {
                    for (var i = 0; i < string.length; i++) {
                        view.setUint8(offset + i, string.charCodeAt(i));
                    }
                }
    
                function encodeWAV(samples) {
                    var buffer = new ArrayBuffer(44 + samples.length * 2);
                    var view = new DataView(buffer);
    
                    /* RIFF identifier */
                    writeString(view, 0, 'RIFF');
                    /* RIFF chunk length */
                    view.setUint32(4, 36 + samples.length * 2, true);
                    /* RIFF type */
                    writeString(view, 8, 'WAVE');
                    /* format chunk identifier */
                    writeString(view, 12, 'fmt ');
                    /* format chunk length */
                    view.setUint32(16, 16, true);
                    /* sample format (raw) */
                    view.setUint16(20, 1, true);
                    /* channel count */
                    view.setUint16(22, numChannels, true);
                    /* sample rate */
                    view.setUint32(24, sampleRate, true);
                    /* byte rate (sample rate * block align) */
                    view.setUint32(28, sampleRate * 4, true);
                    /* block align (channel count * bytes per sample) */
                    view.setUint16(32, numChannels * 2, true);
                    /* bits per sample */
                    view.setUint16(34, 16, true);
                    /* data chunk identifier */
                    writeString(view, 36, 'data');
                    /* data chunk length */
                    view.setUint32(40, samples.length * 2, true);
    
                    floatTo16BitPCM(view, 44, samples);
    
                    return view;
                }
            }, self);
    
            this.worker.postMessage({
                command: 'init',
                config: {
                    sampleRate: this.context.sampleRate,
                    numChannels: this.config.numChannels
                }
            });
    
            this.worker.onmessage = function (e) {
                var cb = _this.callbacks[e.data.command].pop();
                if (typeof cb == 'function') {
                    cb(e.data.data);
                }
            };
        }
    
        _createClass(Recorder, [{
            key: 'record',
            value: function record() {
                this.recording = true;
            }
        }, {
            key: 'stop',
            value: function stop() {
                this.recording = false;
            }
        }, {
            key: 'clear',
            value: function clear() {
                this.worker.postMessage({ command: 'clear' });
            }
        }, {
            key: 'getBuffer',
            value: function getBuffer(cb) {
                cb = cb || this.config.callback;
                if (!cb) throw new Error('Callback not set');
    
                this.callbacks.getBuffer.push(cb);
    
                this.worker.postMessage({ command: 'getBuffer' });
            }
        }, {
            key: 'exportWAV',
            value: function exportWAV(cb, mimeType) {
                mimeType = mimeType || this.config.mimeType;
                cb = cb || this.config.callback;
                if (!cb) throw new Error('Callback not set');
    
                this.callbacks.exportWAV.push(cb);
    
                this.worker.postMessage({
                    command: 'exportWAV',
                    type: mimeType
                });
            }
        }], [{
            key: 'forceDownload',
            value: function forceDownload(blob, filename) {
                var url = (window.URL || window.webkitURL).createObjectURL(blob);
                var link = window.document.createElement('a');
                link.href = url;
                link.download = filename || 'output.mp3';
                var click = document.createEvent("Event");
                click.initEvent("click", true, true);
                link.dispatchEvent(click);
            }
        }]);
    
        return Recorder;
    })();
    
    exports.default = Recorder;
    
    },{"inline-worker":3}],3:[function(require,module,exports){
    "use strict";
    
    module.exports = require("./inline-worker");
    },{"./inline-worker":4}],4:[function(require,module,exports){
    (function (global){
    "use strict";
    
    var _createClass = (function () { function defineProperties(target, props) { for (var key in props) { var prop = props[key]; prop.configurable = true; if (prop.value) prop.writable = true; } Object.defineProperties(target, props); } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();
    
    var _classCallCheck = function (instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } };
    
    var WORKER_ENABLED = !!(global === global.window && global.URL && global.Blob && global.Worker);
    
    var InlineWorker = (function () {
      function InlineWorker(func, self) {
        var _this = this;
    
        _classCallCheck(this, InlineWorker);
    
        if (WORKER_ENABLED) {
          var functionBody = func.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1];
          var url = global.URL.createObjectURL(new global.Blob([functionBody], { type: "text/javascript" }));
    
          return new global.Worker(url);
        }
    
        this.self = self;
        this.self.postMessage = function (data) {
          setTimeout(function () {
            _this.onmessage({ data: data });
          }, 0);
        };
    
        setTimeout(function () {
          func.call(self);
        }, 0);
      }
    
      _createClass(InlineWorker, {
        postMessage: {
          value: function postMessage(data) {
            var _this = this;
    
            setTimeout(function () {
              _this.self.onmessage({ data: data });
            }, 0);
          }
        }
      });
    
      return InlineWorker;
    })();
    
    module.exports = InlineWorker;
    }).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
    },{}]},{},[1])(1)
    });
</script>



<script>


//webkitURL is deprecated but nevertheless
URL = window.URL || window.webkitURL;

var gumStream; 						//stream from getUserMedia()
var rec; 							//Recorder.js object
var input; 							//MediaStreamAudioSourceNode we'll be recording

// shim for AudioContext when it's not avb. 
var AudioContext = window.AudioContext || window.webkitAudioContext;
var audioContext //audio context to help us record

var recordButton = document.getElementById("recordButton");
var stopButton = document.getElementById("stopButton");
var pauseButton = document.getElementById("pauseButton");

//add events to those 2 buttons
recordButton.addEventListener("click", startRecording);
stopButton.addEventListener("click", stopRecording);
pauseButton.addEventListener("click", pauseRecording);

function startRecording() {
    $('#recordingsList').empty()
    
	console.log("recordButton clicked");

    
    var constraints = { audio: true, video:false }


	recordButton.disabled = true;
    recordButton.classList.add('btn','btn-light')
	stopButton.disabled = false;
    stopButton.classList.add('btn','btn-danger')
	pauseButton.disabled = false
    pauseButton.classList.add('btn','btn-danger')


	navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {
		console.log("getUserMedia() success, stream created, initializing Recorder.js ...");

		audioContext = new AudioContext();


		gumStream = stream;
		
		/* use the stream */
		input = audioContext.createMediaStreamSource(stream);

		rec = new Recorder(input,{numChannels:1})

		//start the recording process
		rec.record()

		console.log("Recording started");

		
	}).catch(function(err) {
	  	//enable the record button if getUserMedia() fails
    	recordButton.disabled = false;
        
    	stopButton.disabled = true;
    	pauseButton.disabled = true
	});
}

function pauseRecording(){
	console.log("pauseButton clicked rec.recording=",rec.recording );
	if (rec.recording){
		//pause
		rec.stop();
		pauseButton.innerHTML="Resume";
	}else{
		//resume
		rec.record()
		pauseButton.innerHTML="Pause";

	}
}

function stopRecording() {
	console.log("stopButton clicked");

	//disable the stop button, enable the record too allow for new recordings
	stopButton.disabled = true;
	recordButton.disabled = false;
	pauseButton.disabled = true;

	//reset button just in case the recording is stopped while paused
	pauseButton.innerHTML="Pause";
	
	//tell the recorder to stop the recording
	rec.stop();

	//stop microphone access
	gumStream.getAudioTracks()[0].stop();

	//create the wav blob and pass it on to createDownloadLink
	rec.exportWAV(createDownloadLink);
}

function createDownloadLink(blob) {
	
	var url = URL.createObjectURL(blob);
	var au = document.createElement('audio');
	var li = document.createElement('li');
	var link = document.createElement('a');

	//name of .wav file to use during upload and download (without extendion)
	var filename = new Date().toISOString();

	//add controls to the <audio> element
	au.controls = true;
	au.src = url;
    full_path = au.src
    var changer = document.getElementById("hidden_audio").value = filename;
    
	//save to disk link
	link.href = url;
	link.download = filename+".mp3"; //download forces the browser to donwload the file using the  filename
	link.innerHTML = "دانلود فایل";
    link.classList.add('btn','btn-primary','trash-icon')

	//add the new audio element to li
	li.appendChild(au);

    var spanElement = document.createElement("SPAN");
    spanElement.classList.add('glyphicon', 'glyphicon-trash','btn','btn-danger','row-remover8555');

    li.appendChild(spanElement);
	
	//add the filename to the li
	// li.appendChild(document.createTextNode(filename+".mp3 "))

	//add the save to disk link to li
	li.appendChild(link);

	//upload link
	var upload = document.createElement('a');
	upload.href="#";
    upload.id="upload";
	upload.innerHTML = "اپلود";
	upload.addEventListener("click", function(event){
        $('#upload').attr("disabled","disabled");
		  var xhr=new XMLHttpRequest();
		  xhr.onload=function(e) {
		      if(this.readyState === 4) {
		          console.log("Server returned: ",e.target.responseText);
		      }
		  };
		  var fd=new FormData();
		  fd.append("audio_data",blob, filename,full_path);
          console.log('fd',fd)

          csrftoken = $('input[name=csrfmiddlewaretoken]').val(),
		  xhr.open("POST","/saveVoiceKnowledge/",true);
          xhr.setRequestHeader("X-CSRFToken", csrftoken,full_path); 
		  xhr.send(fd);
          xhr.send(full_path)
	})
    upload.classList.add('btn','btn-primary','trash-icon')
	li.appendChild(document.createTextNode (" "))//add a space in between
	li.appendChild(upload)//add the upload link to li

	//add the li element to the ol
	recordingsList.appendChild(li);
}

</script>



<script>

$(document).ready(function(){
    const measure = $('select#measure')
    const ammount = $('input#num')
    const timer = $('#timer')
    const s = $(timer).find('.seconds')
    const m = $(timer).find('.minutes')
    const h = $(timer).find('.hours')

    var seconds = 0
    var minutes = 0
    var hours = 0

    var interval = null;

    var clockType = undefined;

    $('button#start-countdown').on('click', function(){
        if($(ammount).val() != '' && $(ammount).val() > 0 && $(measure).val() != 0) {
            clockType = 'countdown'
            startClock()
        }
        else if ($(ammount).val() == '') {
            alert('Type in the Ammount')
        }
        else if ($(measure).val() == 0) {
            alert('Select the Unit')
        }
    })

    $('button#recordButton').on('click', function(){
        clockType = 'cronometer'
        if ($(ammount).val() != '' && $(measure).val() == 0) {
            alert('Select the Unit')
        } else if ($(ammount).val() > -1) {
            startClock()
        }
    })

    $('button#pauseButton').on('click', function() {
        console.log('inner',this.innerHTML)
        if(this.innerHTML === 'Resume'){
            pauseClock()
        }

        else if (this.innerHTML === 'Pause'){
            switch (clockType) {
                case 'countdown':
                    countdown()
                    break
                case 'cronometer':
                    cronometer()
                    break
                default:
                    break;
            }
        }
    })

    $('button#stopButton').on('click', function() {
        restartClock()
    })

    $('button#resume-timer').on('click', function() {
      $('button#resume-timer').fadeOut(100)
      $('button#reset-timer').fadeOut(100)
      switch (clockType) {
          case 'countdown':
               countdown()
               break
           case 'cronometer':
               cronometer()
               break
          default:
              break;
      }
    })

    function pad(d) {
        return (d < 10) ? '0' + d.toString() : d.toString()
    }

    function startClock() {
        hasStarted = false
        hasEnded = false

        seconds = 0
        minutes = 0
        hours = 0

        switch ($(measure).val()) {
            case 's':
                if ($(ammount).val() > 3599) {
                    let hou = Math.floor($(ammount).val() / 3600)
                    hours = hou
                    let min = Math.floor(($(ammount).val() - (hou * 3600)) / 60)
                    minutes = min;
                    let sec = ($(ammount).val() - (hou * 3600)) - (min * 60)
                    seconds = sec
                }
                else if ($(ammount).val() > 59) {
                    let min = Math.floor($(ammount).val() / 60)
                    minutes = min
                    let sec = $(ammount).val() - (min * 60)
                    seconds = sec
                }
                else {
                    seconds = $(ammount).val()
                }
                break
            case 'm':
                if ($(ammount).val() > 59) {
                    let hou = Math.floor($(ammount).val() / 60)
                    hours = hou
                    let min = $(ammount).val() - (hou * 60)
                    minutes = min
                }
                else {
                    minutes = $(ammount).val()
                }
                break
            case 'h':
                hours = $(ammount).val()
                break
            default:
                break
        }

        if (seconds <= 10 && clockType == 'countdown' && minutes == 0 && hours == 0) {
          $(timer).find('span').addClass('red')
        }

        refreshClock()

        $('.input-wrapper').slideUp(350)
        setTimeout(function(){
            $('#timer').fadeIn(350)
            $('#pauseButton').fadeIn(350)

        }, 350)

       switch (clockType) {
           case 'countdown':
                countdown()
                break
            case 'cronometer':
                cronometer()
                break
           default:
               break;
       }
    }

    function restartClock() {
        clear(interval)
        hasStarted = false
        hasEnded = false

        seconds = 0
        minutes = 0
        hours = 0

        $(s).text('00')
        $(m).text('00')
        $(h).text('00')

        $(timer).find('span').removeClass('red')

        $('#timer').fadeOut(350)
        $('#pauseButton').fadeOut(100)
        $('button#resume-timer').fadeOut(100)
        $('button#reset-timer').fadeOut(100)
        setTimeout(function(){
            $('.input-wrapper').slideDown(350)
        },350)
    }

    function pauseClock() {
      clear(interval)
      $('#resume-timer').fadeIn()
      $('#reset-timer').fadeIn()
    }

    var hasStarted = false
    var hasEnded = false
    if (hours == 0 && minutes == 0 && seconds == 0 && hasStarted == true) {
        hasEnded = true
    }

    function countdown() {
        hasStarted = true
        interval = setInterval(() => {
            if(hasEnded == false) {
                if (seconds <= 11 && minutes == 0 && hours == 0) {
                  $(timer).find('span').addClass('red')
                }

                if(seconds == 0 && minutes == 0 || (hours > 0  && minutes == 0 && seconds == 0)) {
                    hours--
                    minutes = 59
                    seconds = 60
                    refreshClock()
                }

                if(seconds > 0) {
                    seconds--
                    refreshClock()
                }
                else if (seconds == 0) {
                    minutes--
                    seconds = 59
                    refreshClock()
                }
            }
            else {
                restartClock()
            }

        }, 1000)
    }

    function cronometer() {
        hasStarted = true
        interval = setInterval(() => {
            if (seconds < 59) {
                seconds++
                refreshClock()
            }
            else if (seconds == 59) {
                minutes++
                seconds = 0
                refreshClock()
            }

            if (minutes == 60) {
                hours++
                minutes = 0
                seconds = 0
                refreshClock()
            }

        }, 1000)
    }

    function refreshClock() {
        $(s).text(pad(seconds))
        $(m).text(pad(minutes))
        if (hours < 0) {
            $(s).text('00')
            $(m).text('00')
            $(h).text('00')
        } else {
            $(h).text(pad(hours))
        }

        if (hours == 0 && minutes == 0 && seconds == 0 && hasStarted == true) {
            hasEnded = true
            alert('The Timer has Ended !')
        }
    }

    function clear(intervalID) {
        clearInterval(intervalID)
        console.log('cleared the interval called ' + intervalID)
    }
})

</script>
<script>
$('#id_KnowledgeTitle').attr('required', true)
</script>
<script>
    $("body").on('click', '.row-remover8555', function() {
    $(this).closest('li').remove();
    $.ajax({
        type: 'POST',
        url: '/removeVoice',
        data: {
            id: {{ id }},
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
            action: 'post'
        },
        success: function (json) {
            // if (json['result'] == "success" ){
            //     alert('success')
            // }
        },
        error: function (xhr, errmsg, err) {
            // alert('faild')
        }
    });
    });

    
        

</script>
    {% endblock pageContent %}